{"version":3,"sources":["../src/jsx.js"],"names":["marksy","options","components","tracker","tree","elements","nextElementId","toc","currentId","renderer","html","elementId","presets","code","Object","keys","map","key","mockedReact","createElement","tag","props","componentProps","indexOf","assign","context","children","Function","push","e","language","compile","content","markedOptions","smartypants","sanitize","smartLists"],"mappings":"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","sourcesContent":["import marked from 'marked';\nimport { transform } from '@babel/standalone';\nimport createRenderer, { codeRenderer } from './createRenderer';\n\nexport function marksy(options = {}) {\n  // eslint-disable-next-line no-param-reassign\n  options.components = options.components || {};\n\n  const tracker = {\n    tree: null,\n    elements: null,\n    nextElementId: null,\n    toc: null,\n    currentId: [],\n  };\n  const renderer = createRenderer(tracker, options, {\n    html(html) {\n      try {\n        // eslint-disable-next-line no-plusplus\n        const elementId = tracker.nextElementId++;\n\n        const { code } = transform(html, {\n          presets: ['react'],\n        });\n        const components = Object.keys(options.components).map(key => options.components[key]);\n        const mockedReact = {\n          createElement(tag, props = {}, ...children) {\n            const componentProps =\n              components.indexOf(tag) >= 0\n                ? Object.assign(props || {}, {\n                    // eslint-disable-next-line no-plusplus\n                    key: tracker.nextElementId++,\n                    context: tracker.context,\n                  })\n                : Object.assign(props || {}, {\n                    // eslint-disable-next-line no-plusplus\n                    key: tracker.nextElementId++,\n                  });\n\n            return options.createElement(tag, componentProps, children);\n          },\n        };\n\n        tracker.elements[elementId] =\n          // eslint-disable-next-line no-new-func\n          new Function('React', ...Object.keys(options.components), `return ${code}`)(\n            mockedReact,\n            ...components\n          ) || null;\n\n        tracker.tree.push(tracker.elements[elementId]);\n\n        return `{{${elementId}}}`;\n      } catch (e) {\n        //\n      }\n      return null;\n    },\n    code(code, language) {\n      if (language === 'marksy') {\n        return renderer.html(code);\n      }\n      return codeRenderer(tracker, options)(code, language);\n    },\n  });\n\n  return function compile(content, markedOptions = {}, context = {}) {\n    tracker.tree = [];\n    tracker.elements = {};\n    tracker.toc = [];\n    tracker.nextElementId = 0;\n    tracker.context = context;\n    tracker.currentId = [];\n    marked(\n      content,\n      Object.assign(\n        { renderer, smartypants: true, sanitize: false, smartLists: true },\n        markedOptions\n      )\n    );\n\n    return { tree: tracker.tree, toc: tracker.toc };\n  };\n}\n\nexport default function(options) {\n  return marksy(options);\n}\n"],"file":"jsx.js"}