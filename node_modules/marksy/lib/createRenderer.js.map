{"version":3,"sources":["../src/createRenderer.js"],"names":["codeRenderer","tracker","options","CodeComponent","props","children","createElement","className","language","dangerouslySetInnerHTML","highlight","__html","code","e","console","warn","elementId","nextElementId","elements","key","tree","push","createRenderer","overrides","renderer","marked","Renderer","getTocPosition","toc","level","currentLevel","length","populateInlineContent","content","contentArray","split","extractedElements","map","text","elementIdMatch","match","splice","indexOf","he","decode","addElement","tag","type","inlineContent","elementType","Array","isArray","Object","assign","context","html","paragraph","blockquote","link","href","title","br","hr","strong","del","em","heading","currentId","slice","replace","toLowerCase","id","join","lastToc","tocPosition","list","body","ordered","listitem","table","header","thead","tbody","tablerow","tablecell","flag","align","undefined","codespan","image","src","alt"],"mappings":"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","sourcesContent":["import marked from 'marked';\nimport he from 'he';\n\nexport function codeRenderer(tracker, options) {\n  function CodeComponent(props) {\n    let children;\n    try {\n      // eslint-disable-next-line react/no-danger-with-children\n      children = options.createElement(\n        'code',\n        {\n          className: `language-${props.language}`,\n          dangerouslySetInnerHTML: options.highlight\n            ? { __html: options.highlight(props.language, props.code) }\n            : null,\n        },\n        options.highlight ? null : props.code\n      );\n    } catch (e) {\n      // eslint-disable-next-line\n      console.warn(`${props.language} is not supported by your defined highlighter.`);\n      children = options.createElement('code', null, props.code);\n    }\n\n    return options.createElement('pre', null, children);\n  }\n\n  return (code, language) => {\n    // eslint-disable-next-line no-plusplus, no-param-reassign\n    const elementId = tracker.nextElementId++;\n\n    // eslint-disable-next-line no-param-reassign\n    tracker.elements[elementId] = options.createElement(\n      (options.elements && options.elements.code) || CodeComponent,\n      { key: elementId, code, language }\n    );\n\n    tracker.tree.push(tracker.elements[elementId]);\n\n    return `{{${elementId}}}`;\n  };\n}\n\nexport default function createRenderer(tracker, options, overrides = {}) {\n  const renderer = new marked.Renderer();\n\n  function getTocPosition(toc, level) {\n    let currentLevel = toc.children;\n\n    // eslint-disable-next-line no-constant-condition\n    while (true) {\n      if (!currentLevel.length || currentLevel[currentLevel.length - 1].level === level) {\n        return currentLevel;\n      }\n      currentLevel = currentLevel[currentLevel.length - 1].children;\n    }\n  }\n\n  function populateInlineContent(content = '') {\n    const contentArray = content.split(/(\\{\\{.*?\\}\\})/);\n    const extractedElements = contentArray.map(text => {\n      const elementIdMatch = text.match(/\\{\\{(.*)\\}\\}/);\n      if (elementIdMatch) {\n        tracker.tree.splice(tracker.tree.indexOf(tracker.elements[elementIdMatch[1]]), 1);\n        return tracker.elements[elementIdMatch[1]];\n      }\n      if (text !== '') {\n        return he.decode(text);\n      }\n\n      return null;\n    });\n\n    return extractedElements;\n  }\n\n  function addElement(tag, props = {}, children, type = tag) {\n    // eslint-disable-next-line no-plusplus, no-param-reassign\n    const elementId = tracker.nextElementId++;\n    let inlineContent = null;\n\n    const elementType = options.elements && options.elements[type];\n\n    if (children) {\n      inlineContent = Array.isArray(children)\n        ? children.map(populateInlineContent)\n        : populateInlineContent(children);\n    }\n\n    // eslint-disable-next-line no-param-reassign\n    tracker.elements[elementId] = options.createElement(\n      elementType || tag,\n      Object.assign(\n        {\n          key: elementId,\n        },\n        props,\n        elementType ? { context: tracker.context } : {}\n      ),\n      inlineContent\n    );\n\n    tracker.tree.push(tracker.elements[elementId]);\n\n    return `{{${elementId}}}`;\n  }\n\n  renderer.code = overrides.code || codeRenderer(tracker, options);\n\n  renderer.html =\n    overrides.html ||\n    (html => {\n      // eslint-disable-next-line no-plusplus, no-param-reassign\n      const elementId = tracker.nextElementId++;\n\n      tracker.tree.push(\n        options.createElement('div', {\n          key: elementId,\n          dangerouslySetInnerHTML: {\n            __html: html,\n          },\n        })\n      );\n    });\n\n  renderer.paragraph = overrides.paragraph || (text => addElement('p', null, text));\n\n  renderer.blockquote = overrides.blockquote || (text => addElement('blockquote', null, text));\n\n  renderer.link = overrides.link || ((href, title, text) => addElement('a', { href, title }, text));\n\n  renderer.br = overrides.br || (() => addElement('br'));\n\n  renderer.hr = overrides.hr || (() => addElement('hr'));\n\n  renderer.strong = overrides.strong || (text => addElement('strong', null, text));\n\n  renderer.del = overrides.del || (text => addElement('del', null, text));\n\n  renderer.em = overrides.em || (text => addElement('em', null, text));\n\n  renderer.heading =\n    overrides.heading ||\n    ((text, level) => {\n      // eslint-disable-next-line no-param-reassign\n      tracker.currentId = tracker.currentId.slice(0, level - 1);\n      tracker.currentId.push(text.replace(/\\s/g, '-').toLowerCase());\n\n      const id = tracker.currentId.join('-');\n      const lastToc = tracker.toc[tracker.toc.length - 1];\n\n      if (!lastToc || lastToc.level > level) {\n        tracker.toc.push({\n          id,\n          title: text,\n          level,\n          children: [],\n        });\n      } else {\n        const tocPosition = getTocPosition(lastToc, level);\n\n        tocPosition.push({\n          id,\n          title: text,\n          level,\n          children: [],\n        });\n      }\n\n      return addElement(\n        `h${level}`,\n        {\n          id,\n        },\n        text\n      );\n    });\n\n  renderer.list =\n    overrides.list || ((body, ordered) => addElement(ordered ? 'ol' : 'ul', null, body));\n\n  renderer.listitem = overrides.listitem || (text => addElement('li', null, text));\n\n  renderer.table =\n    overrides.table ||\n    ((header, body) =>\n      addElement('table', null, [\n        addElement('thead', null, header),\n        addElement('tbody', null, body),\n      ]));\n\n  renderer.thead = overrides.thead || (content => addElement('thead', null, content));\n\n  renderer.tbody = overrides.tbody || (content => addElement('tbody', null, content));\n\n  renderer.tablerow = overrides.tablerow || (content => addElement('tr', null, content));\n\n  renderer.tablecell =\n    overrides.tablecell ||\n    ((content, flag) => {\n      const tag = flag.header ? 'th' : 'td';\n      return addElement(tag, { className: flag.align ? `text-${flag.align}` : undefined }, content);\n    });\n\n  renderer.codespan = overrides.codespan || (text => addElement('code', null, text, 'codespan'));\n\n  renderer.image =\n    overrides.image || ((href, title, text) => addElement('img', { src: href, alt: text }));\n\n  return renderer;\n}\n"],"file":"createRenderer.js"}